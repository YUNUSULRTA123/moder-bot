import telebot
from config import TOKEN
from logic import BotModer
bot = telebot.TeleBot(TOKEN)
moder = BotModer()
@bot.message_handler(commands=['role'])
def set_role(message):
    if not message.reply_to_message:
        return bot.reply_to(message, "Команда должна быть ответом на сообщение пользователя.")
    target = message.reply_to_message.from_user
    args = message.text.split()
    if len(args) < 2:
        return bot.reply_to(message, "Использование: /role Модератор")
    role_name = args[1].lower()
    if role_name == "модератор":
        new_role = moder.make_moder(target.id)
        bot.reply_to(message, f"{target.first_name} назначен {new_role}!")
    else:
        bot.reply_to(message, "Неизвестная роль.")
@bot.message_handler(commands=['remove_role'])
def remove_role(message):
    if not message.reply_to_message:
        return bot.reply_to(message, "Команда должна быть ответом на сообщение пользователя.")
    target = message.reply_to_message.from_user
    new_role = moder.remove_role(target.id)
    bot.reply_to(message, f"Роль пользователя {target.first_name} сброшена до {new_role}.")
@bot.message_handler(func=lambda m: True)
def handle_msg(message):
    user_id = message.from_user.id
    bot.reply_to(message, "Ваше сообщение обработано!")
    moder.add_user(user_id)
    moder.add_message(user_id)
    new_role = moder.auto_update_role(user_id)
    if new_role:
        bot.reply_to(message, f"{message.from_user.first_name} теперь {new_role}!")
bot.polling(none_stop=True)
